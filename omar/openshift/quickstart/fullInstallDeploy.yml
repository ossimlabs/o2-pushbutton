defaults:
  type: template
  DEPLOYMENT_TARGET: omar-test
  NFS_SERVER_URL:
  OPENSHIFT_DOCKER_REGISTRY_URL: docker-registry.default.svc:5000
  INSECURE_REPOSITORY: false
  DOCKER_IMAGE_REPO: quay.io/radiantsolutions
  TAG: dev
  REPLICAS: 1
  IMAGE_PULL_SECRET: registry-creds
  RELEASE_NAME: Miami
  RELEASE_NUMBER: 2.9.0
  JAVA_OPTS: "-server -Xms256m -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=1 -XX:+CMSClassUnloadingEnabled -XX:+UseGCOverheadLimit -Djava.awt.headless=true -XshowSettings:vm -Djava.security.egd=file:/dev/./urandom"

  # This is the default memory limit for all applications, you can further override any special apps (oms, geoscript, etc.) by adding this variable below in the service config
  # This is the default memory limit for all applications, you can further override any special apps (oms, geoscript, etc.) by adding this variable below in the service config
  MEMORY_MAX: 1500Mi
  OSSIM_DATA_PV_NAME: ossim-data-test
  OSSIM_DATA_PV_SIZE: 1500Gi
  OSSIM_DATA_MOUNT_PT: /mnt/ossim-data-test

  OSSIM_VIDEO_DATA_PV_NAME: ossim-video-data-test
  OSSIM_VIDEO_DATA_PV_SIZE: 1500Gi
  OSSIM_VIDEO_DATA_MOUNT_PT: /mnt/ossim-data-test

  BASEMAP_PV_NAME: basemap-test
  BASEMAP_PV_SIZE: 75Gi
  BASEMAP_MOUNT_PT: /mnt/basemap-test

  MAPPROXY_PV_NAME: basemap-cache-test
  MAPPROXY_PV_SIZE: 100Gi
  MAPPROXY_MOUNT_PT: /mnt/basemap-cache-test

  WEB_PROXY_CRL_PV_NAME: web-proxy-crl-test
  WEB_PROXY_CRL_PV_SIZE: 1Gi
  WEB_PROXY_CRL_MOUNT_PT: /mnt/web_proxy_crl

  # These are the prefixes of the route before the domain name is appended
  WEB_PROXY_ROUTE_PREFIX: omar-test
  PKI_PROXY_ROUTE_PREFIX: pki-omar-test

# This is a list of dictionaries, defining "phases" of deployment
phases:
  - project:
      template_file: infra/project.json
  
  - web-proxy-route:
      template_file: infra/web-proxy-route.json

    pki-proxy-route:
      template_file: infra/pki-proxy-route.json

  - omar-web-proxy-app:
      IMAGE_NAME: omar-web-proxy-app
      template_file: apps/omar-web-proxy-app.json

    omar-services-monitor-app:
      IMAGE_NAME: omar-services-monitor-app
      template_file: apps/omar-services-monitor-app.json

    # icarus-app:
    #   IMAGE_NAME: icarus-app
    #   template_file: apps/icarus-app.json

    # nifi:
    #   IMAGE_NAME: nifi
    #   template_file: apps/nifi.json
    #   TAG: 1.9.2
    #   MEMORY_MAX: 4000Mi

    omar-admin-server:
      IMAGE_NAME: omar-admin-server
      template_file: apps/omar-admin-server.json

    omar-avro-metadata:
      IMAGE_NAME: omar-avro-metadata
      template_file: apps/omar-avro-metadata.json

    omar-basemap:
      IMAGE_NAME: omar-basemap
      template_file: apps/omar-basemap.json

    # omar-blink:
    #   IMAGE_NAME: omar-blink
    #   template_file: apps/omar-blink.json

  - omar-docs-app:
      IMAGE_NAME: omar-docs-app
      template_file: apps/omar-docs-app.json

    omar-oms-app:
      IMAGE_NAME: omar-oms-app
      template_file: apps/omar-oms-app.json

    omar-download-app:
      IMAGE_NAME: omar-download-app
      template_file: apps/omar-download-app.json

    omar-geoscript-app:
      IMAGE_NAME: omar-geoscript-app
      template_file: apps/omar-geoscript-app.json
      MEMORY_MAX: 3000Mi
      REPLICAS: 2

    omar-mapproxy:
      IMAGE_NAME: omar-mapproxy
      template_file: apps/omar-mapproxy.json

    omar-mensa-app:
      IMAGE_NAME: omar-mensa-app
      template_file: apps/omar-mensa-app.json

    # omar-ml:
    #   IMAGE_NAME: omar-ml
    #   template_file: apps/omar-ml.json

    omar-oldmar-app:
      IMAGE_NAME: omar-oldmar-app
      template_file: apps/omar-oldmar-app.json

    omar-reachback-app:
      IMAGE_NAME: omar-reachback-app
      template_file: apps/omar-reachback-app.json

    omar-stager-app:
      IMAGE_NAME: omar-stager-app
      template_file: apps/omar-stager-app.json

    omar-sqs-stager-app:
      IMAGE_NAME: omar-sqs-stager-app
      template_file: apps/omar-sqs-stager-app.json
      MEMORY_MAX: 3000Mi
      REPLICAS: 2

    omar-superoverlay-app:
      IMAGE_NAME: omar-superoverlay-app
      template_file: apps/omar-superoverlay-app.json

    omar-twofishes:
      IMAGE_NAME: omar-twofishes
      template_file: apps/omar-twofishes.json
      MEMORY_MAX: 3000Mi

    omar-ui-app:
      IMAGE_NAME: omar-ui-app
      template_file: apps/omar-ui-app.json

    omar-upload-app:
      IMAGE_NAME: omar-upload-app
      template_file: apps/omar-upload-app.json

    omar-video-ui:
      IMAGE_NAME: omar-video-ui
      template_file: apps/omar-video-ui.json

    # omar-volume-cleanup:
    #   IMAGE_NAME: omar-volume-cleanup
    #   CLEANUP_DRYRUN: false
    #   DATABASE_URL:
    #   DATABASE_USERNAME:
    #   DATABASE_PASSWORD:
    #   JAVA_TOOL_OPTIONS: "-Xms256m -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=1 -XX:+CMSClassUnloadingEnabled -XX:+UseGCOverheadLimit -Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom"
    #   template_file: apps/omar-volume-cleanup.json

    omar-wcs-app:
      IMAGE_NAME: omar-wcs-app
      template_file: apps/omar-wcs-app.json

    omar-wfs-app:
      IMAGE_NAME: omar-wfs-app
      template_file: apps/omar-wfs-app.json

    omar-wms-app:
      IMAGE_NAME: omar-wms-app
      template_file: apps/omar-wms-app.json

    omar-wmts-app:
      IMAGE_NAME: omar-wmts-app
      template_file: apps/omar-wmts-app.json

    # rabbitmq:
    #   IMAGE_NAME: rabbitmq
    #   template_file: apps/rabbitmq.json

    # tlv-app:
    #   IMAGE_NAME: tlv-app
    #   template_file: apps/tlv-app.json
